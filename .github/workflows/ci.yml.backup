name: Selenium Grid CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to test'
        required: true
        default: 'all'
        type: choice
        options:
          - all      # Run dev â†’ test â†’ prod sequentially
          - dev      # Development environment only
          - test     # Test environment only
          - prod     # Production environment only

      test_suite:
        description: 'Test suite to run'
        required: false
        default: 'smoke'
        type: choice
        options:
          - smoke          # Quick smoke tests
          - ci             # CI test suite
          - extended       # Extended test suite
          - all            # All test suites

permissions:
  contents: write  # Required for GitHub Pages deployment

env:
  JAVA_VERSION: '17'
  MAVEN_OPTS: -Xmx2048m
  # Environment URLs - Update these with your actual URLs
  DEV_BASE_URL: 'https://dev.yourapp.com'
  TEST_BASE_URL: 'https://test.yourapp.com'
  PROD_BASE_URL: 'https://yourapp.com'

jobs:
  detect-changes:
    name: Detect File Changes
    runs-on: ubuntu-latest
    outputs:
      code-changed: ${{ steps.filter.outputs.code-changed }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # Need at least 2 commits to compare

      - name: Detect changed files
        id: filter
        run: |
          # Get list of changed files
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }})
          else
            CHANGED_FILES=$(git diff --name-only HEAD^1 HEAD 2>/dev/null || git ls-files)
          fi

          echo "Changed files:"
          echo "$CHANGED_FILES"

          # Check if any non-documentation files changed
          CODE_CHANGED=$(echo "$CHANGED_FILES" | grep -v -E '\.(md|log|txt|rst|adoc)$' || true)

          if [ -z "$CODE_CHANGED" ]; then
            echo "âœ… Documentation-only change detected - will skip build/test"
            echo "code-changed=false" >> $GITHUB_OUTPUT
          else
            echo "ğŸ“ Code files changed - will run full pipeline"
            echo "code-changed=true" >> $GITHUB_OUTPUT
          fi

  determine-environments:
    name: Determine Environments to Test
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.code-changed == 'true'
    outputs:
      run_dev: ${{ steps.set-envs.outputs.run_dev }}
      run_test: ${{ steps.set-envs.outputs.run_test }}
      run_prod: ${{ steps.set-envs.outputs.run_prod }}
      test_suite: ${{ steps.set-envs.outputs.test_suite }}
      selected_env: ${{ steps.set-envs.outputs.selected_env }}

    steps:
      - name: Determine which environments to run
        id: set-envs
        run: |
          # Get environment selection (default to 'all' for automatic runs)
          ENV_SELECT="${{ github.event.inputs.environment || 'all' }}"
          SUITE_SELECT="${{ github.event.inputs.test_suite || 'smoke' }}"

          echo "ğŸ“Š Environment Selection: $ENV_SELECT"
          echo "ğŸ“Š Test Suite Selection: $SUITE_SELECT"
          echo "selected_env=$ENV_SELECT" >> $GITHUB_OUTPUT
          echo "test_suite=$SUITE_SELECT" >> $GITHUB_OUTPUT

          # Determine which environments to run
          if [ "$ENV_SELECT" == "all" ]; then
            echo "run_dev=true" >> $GITHUB_OUTPUT
            echo "run_test=true" >> $GITHUB_OUTPUT
            echo "run_prod=true" >> $GITHUB_OUTPUT
            echo "âœ… Will run ALL environments sequentially: DEV â†’ TEST â†’ PROD"
          elif [ "$ENV_SELECT" == "dev" ]; then
            echo "run_dev=true" >> $GITHUB_OUTPUT
            echo "run_test=false" >> $GITHUB_OUTPUT
            echo "run_prod=false" >> $GITHUB_OUTPUT
            echo "âœ… Will run DEV environment only"
          elif [ "$ENV_SELECT" == "test" ]; then
            echo "run_dev=false" >> $GITHUB_OUTPUT
            echo "run_test=true" >> $GITHUB_OUTPUT
            echo "run_prod=false" >> $GITHUB_OUTPUT
            echo "âœ… Will run TEST environment only"
          elif [ "$ENV_SELECT" == "prod" ]; then
            echo "run_dev=false" >> $GITHUB_OUTPUT
            echo "run_test=false" >> $GITHUB_OUTPUT
            echo "run_prod=true" >> $GITHUB_OUTPUT
            echo "âœ… Will run PROD environment only"
          else
            # Default to all
            echo "run_dev=true" >> $GITHUB_OUTPUT
            echo "run_test=true" >> $GITHUB_OUTPUT
            echo "run_prod=true" >> $GITHUB_OUTPUT
            echo "âš ï¸  Unknown selection, defaulting to ALL environments"
          fi

  build-and-compile:
    name: Build & Compile
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.code-changed == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Compile project
        run: ./mvnw clean compile test-compile

      - name: Run Checkstyle
        run: |
          echo "Running Checkstyle..."
          ./mvnw checkstyle:check
          echo "âœ… Checkstyle passed: 0 violations"

      - name: Run PMD Analysis
        run: |
          echo "Running PMD code analysis..."
          ./mvnw pmd:check
          echo "âœ… PMD analysis passed"

      - name: Upload PMD Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pmd-report
          path: |
            target/pmd.xml
            target/site/pmd.html
          retention-days: 7
          if-no-files-found: ignore

      - name: Upload compiled classes
        uses: actions/upload-artifact@v4
        with:
          name: compiled-classes
          path: target/
          retention-days: 1

  smoke-tests:
    name: Smoke Tests (Fast Check)
    runs-on: ubuntu-latest
    needs: [detect-changes, build-and-compile]
    if: needs.detect-changes.outputs.code-changed == 'true'

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
          - 4442:4442
          - 4443:4443

      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: >-
          --shm-size=2gb

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          echo "Waiting for Grid Hub..."
          timeout 60 bash -c 'until curl -sf http://localhost:4444/wd/hub/status; do sleep 2; done'
          echo "Grid Hub is up!"

          echo "Waiting for Chrome node to register..."
          sleep 10

          for i in {1..20}; do
            NODES=$(curl -sf http://localhost:4444/wd/hub/status | jq -r '.value.nodes | length' 2>/dev/null || echo "0")
            echo "  Attempt $i: $NODES nodes registered"
            if [ "$NODES" -gt "0" ]; then
              echo "âœ… Grid is ready with $NODES node(s)!"
              break
            fi
            sleep 2
          done

      - name: Verify Grid is ready
        run: |
          echo "Final Grid readiness check..."
          GRID_STATUS=$(curl -sf http://localhost:4444/wd/hub/status)
          echo "$GRID_STATUS" | jq '.'

          READY=$(echo "$GRID_STATUS" | jq -r '.value.ready')
          NODES=$(echo "$GRID_STATUS" | jq -r '.value.nodes | length')

          echo "Grid Ready: $READY"
          echo "Nodes Available: $NODES"

          if [ "$READY" != "true" ] || [ "$NODES" -eq "0" ]; then
            echo "âŒ Grid is not ready! Aborting smoke tests."
            exit 1
          fi

          echo "âœ… Grid is fully ready with $NODES node(s)"

      - name: Run Smoke Tests
        timeout-minutes: 5
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
        run: |
          echo "Starting smoke tests..."
          echo "Grid URL: $SELENIUM_REMOTE_URL"

          ./mvnw test -DsuiteXmlFile=testng-smoke-suite.xml

          echo "Smoke tests completed"

      - name: Verify smoke results
        if: always()
        run: |
          echo "ğŸ”¥ Smoke Test Results:"
          echo "  Test XML files: $(find target/surefire-reports -name "TEST-*.xml" 2>/dev/null | wc -l)"

          TOTAL_FAILURES=0
          TOTAL_ERRORS=0

          if [ -d "target/surefire-reports" ]; then
            echo ""
            echo "Surefire Reports:"
            ls -la target/surefire-reports/
            echo ""

            for xml in target/surefire-reports/TEST-*.xml; do
              if [ -f "$xml" ]; then
                echo "Report: $xml"

                FAILURES=$(grep -oP 'failures="\K[0-9]+' "$xml" | head -1 || echo "0")
                ERRORS=$(grep -oP 'errors="\K[0-9]+' "$xml" | head -1 || echo "0")
                TESTS=$(grep -oP 'tests="\K[0-9]+' "$xml" | head -1 || echo "0")

                echo "  Tests: $TESTS, Failures: $FAILURES, Errors: $ERRORS"

                TOTAL_FAILURES=$((TOTAL_FAILURES + FAILURES))
                TOTAL_ERRORS=$((TOTAL_ERRORS + ERRORS))
              fi
            done

            echo ""
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo "Total Failures: $TOTAL_FAILURES"
            echo "Total Errors: $TOTAL_ERRORS"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

            if [ "$TOTAL_FAILURES" -gt "0" ] || [ "$TOTAL_ERRORS" -gt "0" ]; then
              echo ""
              echo "âŒ SMOKE TESTS FAILED!"
              echo "   Failures: $TOTAL_FAILURES"
              echo "   Errors: $TOTAL_ERRORS"
              exit 1
            else
              echo ""
              echo "âœ… ALL SMOKE TESTS PASSED!"
            fi
          else
            echo "âš ï¸  No surefire-reports directory found"
            exit 1
          fi

  # ==================================================================================
  # ENVIRONMENT-SPECIFIC TEST JOBS
  # Run tests against DEV, TEST, and PROD environments
  # Can run all sequentially or select specific environment
  # ==================================================================================

  test-dev-environment:
    name: Test DEV Environment
    runs-on: ubuntu-latest
    needs: [detect-changes, determine-environments, build-and-compile, smoke-tests]
    if: |
      needs.detect-changes.outputs.code-changed == 'true' &&
      needs.determine-environments.outputs.run_dev == 'true'

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: --shm-size=2gb

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          timeout 60 bash -c 'until curl -sf http://localhost:4444/wd/hub/status; do sleep 2; done'
          echo "âœ… Grid ready"

      - name: Run Tests in DEV Environment
        timeout-minutes: 15
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
          TEST_ENVIRONMENT: dev
          BASE_URL: ${{ env.DEV_BASE_URL }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”§ Testing DEV Environment"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Environment: DEV"
          echo "URL: $BASE_URL"
          echo "Suite: ${{ needs.determine-environments.outputs.test_suite }}"
          echo ""

          ./mvnw test \
            -Dtest.environment=dev \
            -DsuiteXmlFile=testng-${{ needs.determine-environments.outputs.test_suite }}-suite.xml

      - name: Upload DEV Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-dev-environment
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7

  test-test-environment:
    name: Test TEST Environment
    runs-on: ubuntu-latest
    needs: [detect-changes, determine-environments, build-and-compile, smoke-tests, test-dev-environment]
    if: |
      always() &&
      needs.detect-changes.outputs.code-changed == 'true' &&
      needs.determine-environments.outputs.run_test == 'true' &&
      (needs.test-dev-environment.result == 'success' || needs.test-dev-environment.result == 'skipped')

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: --shm-size=2gb

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          timeout 60 bash -c 'until curl -sf http://localhost:4444/wd/hub/status; do sleep 2; done'
          echo "âœ… Grid ready"

      - name: Run Tests in TEST Environment
        timeout-minutes: 15
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
          TEST_ENVIRONMENT: test
          BASE_URL: ${{ env.TEST_BASE_URL }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ§ª Testing TEST Environment"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Environment: TEST"
          echo "URL: $BASE_URL"
          echo "Suite: ${{ needs.determine-environments.outputs.test_suite }}"
          echo ""

          ./mvnw test \
            -Dtest.environment=test \
            -DsuiteXmlFile=testng-${{ needs.determine-environments.outputs.test_suite }}-suite.xml

      - name: Upload TEST Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-test-environment
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7

  test-prod-environment:
    name: Test PROD Environment
    runs-on: ubuntu-latest
    needs: [detect-changes, determine-environments, build-and-compile, smoke-tests, test-test-environment]
    if: |
      always() &&
      needs.detect-changes.outputs.code-changed == 'true' &&
      needs.determine-environments.outputs.run_prod == 'true' &&
      (needs.test-test-environment.result == 'success' || needs.test-test-environment.result == 'skipped')

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: --shm-size=2gb

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          timeout 60 bash -c 'until curl -sf http://localhost:4444/wd/hub/status; do sleep 2; done'
          echo "âœ… Grid ready"

      - name: Run Tests in PROD Environment
        timeout-minutes: 15
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
          TEST_ENVIRONMENT: prod
          BASE_URL: ${{ env.PROD_BASE_URL }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ­ Testing PROD Environment"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Environment: PROD"
          echo "URL: $BASE_URL"
          echo "Suite: ${{ needs.determine-environments.outputs.test_suite }}"
          echo ""

          ./mvnw test \
            -Dtest.environment=prod \
            -DsuiteXmlFile=testng-${{ needs.determine-environments.outputs.test_suite }}-suite.xml

      - name: Upload PROD Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-prod-environment
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7

  selenium-grid-tests:
    name: Grid Tests - ${{ matrix.browser }}
    runs-on: ubuntu-latest
    needs: [detect-changes, build-and-compile]
    if: needs.detect-changes.outputs.code-changed == 'true'

    strategy:
      matrix:
        browser: [chrome, firefox]
      fail-fast: false

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
          - 4442:4442
          - 4443:4443

      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: >-
          --shm-size=2gb

      firefox-node:
        image: selenium/node-firefox:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 5
        options: >-
          --shm-size=2gb

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          echo "Waiting for Grid Hub..."
          timeout 60 bash -c 'until curl -sf http://localhost:4444/wd/hub/status; do sleep 2; done'
          echo "Grid Hub is up!"

          echo "Waiting for browser nodes to register..."
          sleep 10

          echo "Checking Grid status..."
          curl -sf http://localhost:4444/wd/hub/status | jq '.' || true

          echo "Verifying nodes are available..."
          for i in {1..30}; do
            NODES=$(curl -sf http://localhost:4444/wd/hub/status | jq -r '.value.nodes | length' 2>/dev/null || echo "0")
            echo "  Attempt $i: $NODES nodes registered"
            if [ "$NODES" -gt "0" ]; then
              echo "âœ… Grid is ready with $NODES node(s)!"
              curl -sf http://localhost:4444/wd/hub/status | jq '.value.nodes[] | {id: .id, availability: .availability, maxSessions: .maxSessions}' || true
              break
            fi
            if [ "$i" -eq "30" ]; then
              echo "âŒ ERROR: No nodes registered after 60 seconds!"
              echo "Grid will not be functional. Failing job."
              exit 1
            fi
            sleep 2
          done

      - name: Verify Grid is ready
        run: |
          echo "Final Grid readiness check..."
          GRID_STATUS=$(curl -sf http://localhost:4444/wd/hub/status)
          echo "$GRID_STATUS" | jq '.'

          READY=$(echo "$GRID_STATUS" | jq -r '.value.ready')
          NODES=$(echo "$GRID_STATUS" | jq -r '.value.nodes | length')

          echo "Grid Ready: $READY"
          echo "Nodes Available: $NODES"

          if [ "$READY" != "true" ] || [ "$NODES" -eq "0" ]; then
            echo "âŒ Grid is not ready! Aborting tests."
            exit 1
          fi

          echo "âœ… Grid is fully ready with $NODES node(s)"

      - name: Run Grid Tests
        timeout-minutes: 15
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
          BROWSER: ${{ matrix.browser }}
        run: |
          echo "Starting Grid tests with ${{ matrix.browser }}..."
          ./mvnw test -DsuiteXmlFile=testng-ci-suite.xml
          echo "Grid tests completed"

      - name: Verify test results
        if: always()
        run: |
          echo "ğŸ“Š Test Results Summary (${{ matrix.browser }}):"
          echo "  Surefire reports: $(find target/surefire-reports -name "*.xml" 2>/dev/null | wc -l) files"
          echo "  Allure results: $(find target/allure-results -name "*-result.json" 2>/dev/null | wc -l) tests"
          echo "  Screenshots: $(find target/allure-results -name "*.png" 2>/dev/null | wc -l) images"
          echo "  Total Allure files: $(find target/allure-results -type f 2>/dev/null | wc -l)"

          TOTAL_FAILURES=0
          TOTAL_ERRORS=0
          TOTAL_TESTS=0

          if [ -d "target/surefire-reports" ]; then
            echo ""
            echo "Test Execution Summary:"
            for xml in target/surefire-reports/TEST-*.xml; do
              if [ -f "$xml" ]; then
                echo "  $(basename $xml):"

                FAILURES=$(grep -oP 'failures="\K[0-9]+' "$xml" | head -1 || echo "0")
                ERRORS=$(grep -oP 'errors="\K[0-9]+' "$xml" | head -1 || echo "0")
                TESTS=$(grep -oP 'tests="\K[0-9]+' "$xml" | head -1 || echo "0")

                echo "    Tests: $TESTS, Failures: $FAILURES, Errors: $ERRORS"

                TOTAL_TESTS=$((TOTAL_TESTS + TESTS))
                TOTAL_FAILURES=$((TOTAL_FAILURES + FAILURES))
                TOTAL_ERRORS=$((TOTAL_ERRORS + ERRORS))
              fi
            done

            echo ""
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo "Browser: ${{ matrix.browser }}"
            echo "Total Tests: $TOTAL_TESTS"
            echo "Total Failures: $TOTAL_FAILURES"
            echo "Total Errors: $TOTAL_ERRORS"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

            if [ "$TOTAL_FAILURES" -gt "0" ] || [ "$TOTAL_ERRORS" -gt "0" ]; then
              echo ""
              echo "âŒ GRID TESTS FAILED (${{ matrix.browser }})!"
              echo "   Failures: $TOTAL_FAILURES"
              echo "   Errors: $TOTAL_ERRORS"
              exit 1
            else
              echo ""
              echo "âœ… ALL GRID TESTS PASSED (${{ matrix.browser }})!"
            fi
          else
            echo "âš ï¸  No surefire-reports directory found"
            exit 1
          fi

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-${{ matrix.browser }}
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7
          if-no-files-found: warn

      - name: Upload screenshots
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: screenshots-${{ matrix.browser }}
          path: target/screenshots/
          retention-days: 7

  mobile-browser-tests:
    name: Mobile Browser Tests
    runs-on: ubuntu-latest
    needs: [detect-changes, build-and-compile]
    if: needs.detect-changes.outputs.code-changed == 'true'

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
        options: >-
          --health-cmd "curl -f http://localhost:4444/wd/hub/status || exit 1"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 2

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          echo "â³ Waiting for Selenium Grid to be ready..."
          for i in {1..30}; do
            if curl -f http://localhost:4444/wd/hub/status &>/dev/null; then
              echo "âœ… Grid is ready!"
              break
            fi
            echo "  Attempt $i/30: Grid not ready yet, waiting..."
            sleep 2
          done

          echo "ğŸ“Š Grid Status:"
          curl -s http://localhost:4444/wd/hub/status | jq '.' || echo "Failed to get status"

      - name: Run Mobile Browser Tests
        timeout-minutes: 10
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
        run: |
          echo "Starting mobile browser tests..."
          echo "Grid URL: $SELENIUM_REMOTE_URL"

          ./mvnw test -DsuiteXmlFile=testng-mobile-browser-suite.xml

          echo "Mobile browser tests completed"

      - name: Verify test results
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“± MOBILE BROWSER TEST RESULTS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          if [ ! -d "target/surefire-reports" ] || [ -z "$(ls -A target/surefire-reports/*.xml 2>/dev/null)" ]; then
            echo "âŒ ERROR: No test reports found!"
            exit 1
          fi

          TOTAL_TESTS=0
          TOTAL_FAILURES=0
          TOTAL_ERRORS=0
          TOTAL_SKIPPED=0

          for xml_file in target/surefire-reports/TEST-*.xml; do
            if [ -f "$xml_file" ]; then
              tests=$(grep -oP 'tests="\K[0-9]+' "$xml_file" | head -1)
              failures=$(grep -oP 'failures="\K[0-9]+' "$xml_file" | head -1)
              errors=$(grep -oP 'errors="\K[0-9]+' "$xml_file" | head -1)
              skipped=$(grep -oP 'skipped="\K[0-9]+' "$xml_file" | head -1)

              TOTAL_TESTS=$((TOTAL_TESTS + ${tests:-0}))
              TOTAL_FAILURES=$((TOTAL_FAILURES + ${failures:-0}))
              TOTAL_ERRORS=$((TOTAL_ERRORS + ${errors:-0}))
              TOTAL_SKIPPED=$((TOTAL_SKIPPED + ${skipped:-0}))
            fi
          done

          echo "Test Results:"
          echo "  Total: $TOTAL_TESTS"
          echo "  Passed: $((TOTAL_TESTS - TOTAL_FAILURES - TOTAL_ERRORS - TOTAL_SKIPPED))"
          echo "  Failed: $TOTAL_FAILURES"
          echo "  Errors: $TOTAL_ERRORS"
          echo "  Skipped: $TOTAL_SKIPPED"

          if [ "$TOTAL_FAILURES" -gt "0" ] || [ "$TOTAL_ERRORS" -gt "0" ]; then
            echo "âŒ MOBILE BROWSER TESTS FAILED!"
            grep -r "FAILED" target/surefire-reports/ || true
            exit 1
          fi

          if [ "$TOTAL_TESTS" -eq "0" ]; then
            echo "âš ï¸  WARNING: No tests executed!"
            exit 1
          fi

          echo "âœ… All $TOTAL_TESTS mobile browser tests passed!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: Upload mobile browser test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-mobile-browser
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7

  responsive-design-tests:
    name: Responsive Design Tests
    runs-on: ubuntu-latest
    needs: [detect-changes, build-and-compile]
    if: needs.detect-changes.outputs.code-changed == 'true'

    services:
      selenium-hub:
        image: selenium/hub:4.26.0
        ports:
          - 4444:4444
        options: >-
          --health-cmd "curl -f http://localhost:4444/wd/hub/status || exit 1"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

      chrome-node:
        image: selenium/node-chrome:4.26.0
        env:
          SE_EVENT_BUS_HOST: selenium-hub
          SE_EVENT_BUS_PUBLISH_PORT: 4442
          SE_EVENT_BUS_SUBSCRIBE_PORT: 4443
          SE_NODE_MAX_SESSIONS: 2

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '21'
          cache: 'maven'

      - name: Wait for Selenium Grid
        run: |
          echo "â³ Waiting for Selenium Grid to be ready..."
          for i in {1..30}; do
            if curl -f http://localhost:4444/wd/hub/status &>/dev/null; then
              echo "âœ… Grid is ready!"
              break
            fi
            echo "  Attempt $i/30: Grid not ready yet, waiting..."
            sleep 2
          done

          echo "ğŸ“Š Grid Status:"
          curl -s http://localhost:4444/wd/hub/status | jq '.' || echo "Failed to get status"

      - name: Run Responsive Design Tests
        timeout-minutes: 10
        env:
          SELENIUM_REMOTE_URL: http://localhost:4444/wd/hub
        run: |
          echo "Starting responsive design tests..."
          echo "Grid URL: $SELENIUM_REMOTE_URL"

          ./mvnw test -DsuiteXmlFile=testng-responsive-suite.xml

          echo "Responsive design tests completed"

      - name: Verify test results
        if: always()
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“ RESPONSIVE DESIGN TEST RESULTS"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          if [ ! -d "target/surefire-reports" ] || [ -z "$(ls -A target/surefire-reports/*.xml 2>/dev/null)" ]; then
            echo "âŒ ERROR: No test reports found!"
            exit 1
          fi

          TOTAL_TESTS=0
          TOTAL_FAILURES=0
          TOTAL_ERRORS=0
          TOTAL_SKIPPED=0

          for xml_file in target/surefire-reports/TEST-*.xml; do
            if [ -f "$xml_file" ]; then
              tests=$(grep -oP 'tests="\K[0-9]+' "$xml_file" | head -1)
              failures=$(grep -oP 'failures="\K[0-9]+' "$xml_file" | head -1)
              errors=$(grep -oP 'errors="\K[0-9]+' "$xml_file" | head -1)
              skipped=$(grep -oP 'skipped="\K[0-9]+' "$xml_file" | head -1)

              TOTAL_TESTS=$((TOTAL_TESTS + ${tests:-0}))
              TOTAL_FAILURES=$((TOTAL_FAILURES + ${failures:-0}))
              TOTAL_ERRORS=$((TOTAL_ERRORS + ${errors:-0}))
              TOTAL_SKIPPED=$((TOTAL_SKIPPED + ${skipped:-0}))
            fi
          done

          echo "Test Results:"
          echo "  Total: $TOTAL_TESTS"
          echo "  Passed: $((TOTAL_TESTS - TOTAL_FAILURES - TOTAL_ERRORS - TOTAL_SKIPPED))"
          echo "  Failed: $TOTAL_FAILURES"
          echo "  Errors: $TOTAL_ERRORS"
          echo "  Skipped: $TOTAL_SKIPPED"

          if [ "$TOTAL_FAILURES" -gt "0" ] || [ "$TOTAL_ERRORS" -gt "0" ]; then
            echo "âŒ RESPONSIVE DESIGN TESTS FAILED!"
            grep -r "FAILED" target/surefire-reports/ || true
            exit 1
          fi

          if [ "$TOTAL_TESTS" -eq "0" ]; then
            echo "âš ï¸  WARNING: No tests executed!"
            exit 1
          fi

          echo "âœ… All $TOTAL_TESTS responsive design tests passed!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: Upload responsive design test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-responsive-design
          path: |
            target/surefire-reports/
            target/allure-results/
          retention-days: 7

  allure-report:
    name: Generate Allure Report
    runs-on: ubuntu-latest
    needs: [detect-changes, smoke-tests, test-dev-environment, test-test-environment, test-prod-environment, selenium-grid-tests, mobile-browser-tests, responsive-design-tests]
    if: always() && needs.detect-changes.outputs.code-changed == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download all test results
        uses: actions/download-artifact@v4
        with:
          pattern: test-results-*
          path: test-results

      - name: Prepare Allure results
        if: always()
        run: |
          echo "ğŸ“Š Merging Allure results from all browsers..."
          mkdir -p allure-results

          # Copy all result files directly (works regardless of directory structure)
          find test-results -name "*-result.json" -exec cp {} allure-results/ \; 2>&1 || true
          find test-results -name "*-container.json" -exec cp {} allure-results/ \; 2>&1 || true
          find test-results -name "*-attachment.*" -exec cp {} allure-results/ \; 2>&1 || true

          echo "âœ… Merge complete!"
          echo "  JSON results: $(find allure-results -name "*-result.json" | wc -l)"
          echo "  Screenshots: $(find allure-results -name "*.png" | wc -l)"
          echo "  Total files: $(find allure-results -type f | wc -l)"

      - name: Install Allure CLI
        if: always()
        run: |
          echo "Installing Allure CLI..."
          wget -q https://github.com/allure-framework/allure2/releases/download/2.25.0/allure-2.25.0.tgz
          tar -zxf allure-2.25.0.tgz
          sudo mv allure-2.25.0 /opt/allure
          sudo ln -s /opt/allure/bin/allure /usr/local/bin/allure
          allure --version
          echo "âœ… Allure CLI installed"

      - name: Generate Allure Report
        if: always()
        run: |
          echo "Generating Allure report..."
          mkdir -p allure-results/history
          allure generate allure-results --clean -o allure-report
          echo "âœ… Report generated successfully!"
          ls -la allure-report/

      - name: Upload Allure Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: allure-report
          path: allure-report/
          retention-days: 30

      - name: Deploy to GitHub Pages
        if: always() && github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./allure-report
          keep_files: false
          force_orphan: true  # Force push to resolve branch conflicts
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'

      - name: Report Info
        if: always()
        run: |
          echo "ğŸ“Š Allure Report Generated!"
          echo ""
          if [ "${{ github.ref }}" = "refs/heads/main" ]; then
            echo "ğŸŒ View online report at:"
            echo "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
            echo ""
          fi
          echo "ğŸ“¥ Or download the 'allure-report' artifact:"
          echo "1. Go to this workflow run"
          echo "2. Scroll to Artifacts section"
          echo "3. Click 'allure-report' to download"
          echo "4. Extract and open index.html"

  code-quality:
    name: Code Quality Analysis
    runs-on: ubuntu-latest
    needs: [detect-changes, build-and-compile]
    if: needs.detect-changes.outputs.code-changed == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Run Checkstyle
        run: |
          echo "Running Checkstyle static analysis..."
          ./mvnw checkstyle:check
          echo "âœ… Checkstyle analysis completed"
        continue-on-error: true

      - name: Upload Checkstyle Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: checkstyle-report
          path: |
            target/checkstyle-result.xml
            target/site/checkstyle.html
          retention-days: 7
          if-no-files-found: ignore

  docker-build:
    name: Docker Build Test
    runs-on: ubuntu-latest
    needs: detect-changes
    if: needs.detect-changes.outputs.code-changed == 'true'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build Docker test container
        run: docker compose build tests

      - name: Verify container can run
        run: docker run --rm selenium_java_docker-tests:latest ./mvnw --version

  test-summary:
    name: Test Summary
    runs-on: ubuntu-latest
    needs: [detect-changes, smoke-tests, test-dev-environment, test-test-environment, test-prod-environment, selenium-grid-tests, mobile-browser-tests, responsive-design-tests, allure-report]
    if: always() && needs.detect-changes.outputs.code-changed == 'true'

    steps:
      - name: Download test results
        uses: actions/download-artifact@v4
        with:
          pattern: test-results-*
          path: test-results

      - name: Create test summary
        run: |
          echo "## ğŸ§ª Test Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Test Results by Browser" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          for browser in chrome firefox; do
            if [ -d "test-results/test-results-$browser" ]; then
              echo "#### ${browser^} Browser" >> $GITHUB_STEP_SUMMARY

              # Count test results
              total=$(find "test-results/test-results-$browser" -name "TEST-*.xml" -exec grep -h "tests=" {} \; | head -1 | sed 's/.*tests="\([0-9]*\)".*/\1/' || echo "0")
              failures=$(find "test-results/test-results-$browser" -name "TEST-*.xml" -exec grep -h "failures=" {} \; | head -1 | sed 's/.*failures="\([0-9]*\)".*/\1/' || echo "0")
              errors=$(find "test-results/test-results-$browser" -name "TEST-*.xml" -exec grep -h "errors=" {} \; | head -1 | sed 's/.*errors="\([0-9]*\)".*/\1/' || echo "0")

              if [ "$failures" = "0" ] && [ "$errors" = "0" ]; then
                echo "âœ… All tests passed!" >> $GITHUB_STEP_SUMMARY
              else
                echo "âŒ Some tests failed" >> $GITHUB_STEP_SUMMARY
              fi

              echo "- Tests: $total" >> $GITHUB_STEP_SUMMARY
              echo "- Failures: $failures" >> $GITHUB_STEP_SUMMARY
              echo "- Errors: $errors" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
            fi
          done

          echo "### ğŸ“Š Allure Report" >> $GITHUB_STEP_SUMMARY
          echo "Download the 'allure-report' artifact to view detailed test results" >> $GITHUB_STEP_SUMMARY

  deploy-dev:
    name: Deploy to DEV
    runs-on: ubuntu-latest
    needs: [detect-changes, smoke-tests, test-dev-environment, test-test-environment, test-prod-environment, selenium-grid-tests, mobile-browser-tests, responsive-design-tests, code-quality, docker-build]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push' && needs.detect-changes.outputs.code-changed == 'true'
    environment:
      name: development
      url: https://your-development-url.com

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deployment Status Check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸš€ DEPLOYMENT TO DEV ENVIRONMENT"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"
          echo "Author: ${{ github.actor }}"
          echo ""
          echo "âœ… All prerequisite stages passed:"
          echo "   - Build & Compile"
          echo "   - Smoke Tests"
          echo "   - Grid Tests (Chrome & Firefox)"
          echo "   - Mobile Browser Tests"
          echo "   - Responsive Design Tests"
          echo "   - Code Quality Checks"
          echo "   - Docker Build"
          echo ""
          echo "ğŸ“‹ Deployment Steps (Placeholder):"
          echo "   â­ï¸  Actual deployment steps will be configured later"
          echo "   â­ï¸  This stage validates all tests passed"
          echo ""
          echo "âœ… DEV deployment validation: PASSED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  deploy-test:
    name: Deploy to TEST
    runs-on: ubuntu-latest
    needs: [detect-changes, deploy-dev]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push' && needs.detect-changes.outputs.code-changed == 'true'
    environment:
      name: test
      url: https://your-test-url.com

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deployment Status Check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ”§ DEPLOYMENT TO TEST ENVIRONMENT"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"
          echo "Author: ${{ github.actor }}"
          echo ""
          echo "âœ… Prerequisites:"
          echo "   - DEV deployment successful"
          echo "   - All quality gates passed"
          echo ""
          echo "ğŸ“‹ Deployment Steps (Placeholder):"
          echo "   â­ï¸  Actual deployment steps will be configured later"
          echo "   â­ï¸  This stage validates DEV deployment succeeded"
          echo ""
          echo "âœ… TEST deployment validation: PASSED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  deploy-prod:
    name: Deploy to PROD
    runs-on: ubuntu-latest
    needs: [detect-changes, deploy-test]
    if: github.ref == 'refs/heads/main' && github.event_name == 'push' && needs.detect-changes.outputs.code-changed == 'true'
    environment:
      name: production
      url: https://your-production-url.com

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deployment Status Check
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ­ DEPLOYMENT TO PRODUCTION ENVIRONMENT"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âš ï¸  PRODUCTION DEPLOYMENT"
          echo ""
          echo "Branch: ${{ github.ref_name }}"
          echo "Commit: ${{ github.sha }}"
          echo "Author: ${{ github.actor }}"
          echo ""
          echo "âœ… Prerequisites:"
          echo "   - DEV deployment successful"
          echo "   - TEST deployment successful"
          echo "   - All quality gates passed"
          echo ""
          echo "ğŸ“‹ Deployment Steps (Placeholder):"
          echo "   â­ï¸  Actual deployment steps will be configured later"
          echo "   â­ï¸  This stage validates TEST deployment succeeded"
          echo "   â­ï¸  Production environment protection enabled"
          echo ""
          echo "âœ… PROD deployment validation: PASSED"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  pipeline-summary:
    name: Pipeline Summary
    runs-on: ubuntu-latest
    needs: detect-changes
    if: always()

    steps:
      - name: Pipeline Summary
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ğŸ“Š PIPELINE EXECUTION SUMMARY"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          if [ "${{ needs.detect-changes.outputs.code-changed }}" = "true" ]; then
            echo "ğŸ“ Change Type: CODE CHANGES DETECTED"
            echo "âœ… Full pipeline executed (build, test, quality checks)"
          else
            echo "ğŸ“„ Change Type: DOCUMENTATION-ONLY"
            echo "â­ï¸  Skipped: Build, tests, quality checks (not needed for docs)"
            echo "âœ… Documentation changes processed successfully"
          fi
          echo ""
          echo "Commit: ${{ github.sha }}"
          echo "Branch: ${{ github.ref_name }}"
          echo "Author: ${{ github.actor }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
