# Docker Compose for Development Environment
# Usage: docker-compose -f docker-compose.dev.yml up

services:
  # Selenium Hub
  selenium-hub:
    image: seleniarm/hub:latest
    container_name: selenium-hub-dev
    platform: linux/arm64
    ports:
      - "4444:4444"
      - "4442:4442"
      - "4443:4443"
    environment:
      - GRID_MAX_SESSION=5
      - GRID_BROWSER_TIMEOUT=180
      - GRID_TIMEOUT=180
      - SE_SESSION_REQUEST_TIMEOUT=180
    networks:
      - selenium-grid-dev
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4444/wd/hub/status"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Single Chrome node for dev
  chrome-node:
    image: seleniarm/node-chromium:latest
    container_name: chrome-node-dev
    platform: linux/arm64
    depends_on:
      selenium-hub:
        condition: service_healthy
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=3
      - SE_NODE_SESSION_TIMEOUT=180
      - SE_VNC_NO_PASSWORD=1
      - SE_SCREEN_WIDTH=1280
      - SE_SCREEN_HEIGHT=720
      - SE_VIDEO_RECORD_ENABLED=false
    ports:
      - "5900:5900"
      - "7900:7900"
    shm_size: 1gb
    networks:
      - selenium-grid-dev
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5555/status"]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  selenium-grid-dev:
    driver: bridge

# Development notes:
# - Single browser node for faster startup
# - Reduced resource limits
# - Shorter timeouts
# - Video recording disabled by default
# - Smaller screen resolution
